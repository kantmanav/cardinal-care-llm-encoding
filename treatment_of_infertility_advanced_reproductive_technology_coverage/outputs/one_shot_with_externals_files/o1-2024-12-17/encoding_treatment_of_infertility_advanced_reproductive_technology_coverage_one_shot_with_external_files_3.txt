:- import('../../rules.hrf').
:- import('../../../../Cardinal Care Core/Precertification Required/rules.hrf').
:- import('../../Non-basic Infertility Services/rules.hrf').

covered(C) :-
  claim.service_type(C, SType)
  & (
      eq(SType, ivf_for_fertility_preservation)
      | eq(SType, cryopreservation_for_fertility_preservation)
    )
  & claim.location_service_received(C, Loc)
  & distinct(Loc, other)
  & claim.num_other_covered_art_services(C, Used)
  & less(Used, 1)
  & (
      claim.inseminations_not_expected_to_be_effective_and_ivf_expected_to_be_only_effective_treatment(C, yes)
      | (
          claim.num_cycles_oral_or_injectable_ovulation_induction(C, NumCycles)
          & leq(3, NumCycles)
        )
    )
  & claim.patient_is_believed_to_be_fertile(C, yes)
  & claim.planned_service(C, Planned)
  & (
      eq(Planned, chemotherapy)
      | eq(Planned, pelvic_radiotherapy)
      | eq(Planned, gonadotoxic_therapy)
      | eq(Planned, orchiectomy)
      | eq(Planned, oophorectomy)
      | eq(Planned, hysterectomy)
      | eq(Planned, orchiectomy_for_treatment_of_disease)
      | eq(Planned, oophorectomy_for_treatment_of_disease)
      | eq(Planned, other_treatment_demonstrated_to_result_in_infertility)
    )
  & (
      claim.will_be_retrieving_eggs_for_use(C, no)
      | (
          claim.will_be_retrieving_eggs_for_use(C, yes)
          & (
              claim.patient_has_premature_ovarian_failure(C, yes)
              | claim.patient_has_premature_ovarian_failure(C, no)
            )
        )
    ).

