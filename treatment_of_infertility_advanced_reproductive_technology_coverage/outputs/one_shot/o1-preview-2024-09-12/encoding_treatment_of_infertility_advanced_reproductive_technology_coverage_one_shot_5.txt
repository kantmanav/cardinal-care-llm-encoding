covered(C) :-
    claim.service_type(C, ServiceType),
    allowed_service_type(ServiceType),
    claim.location_service_received(C, Location),
    in_network_location(Location),
    claim.patient_is_believed_to_be_fertile(C, yes),
    claim.planned_service(C, PlannedService),
    allowed_planned_service(PlannedService),
    claim.will_be_retrieving_eggs_for_use(C, yes),
    not_exceeded_max_cycles(C).

allowed_service_type(ivf_for_fertility_preservation).
allowed_service_type(cryopreservation_for_fertility_preservation).

in_network_location(stanford_health_care).
in_network_location(menlo_medical_clinic).
in_network_location(sutter_health_palo_alto_medical_foundation).
in_network_location(tier_two_in_network).

allowed_planned_service(chemotherapy).
allowed_planned_service(pelvic_radiotherapy).
allowed_planned_service(gonadotoxic_therapy).
allowed_planned_service(orchiectomy).
allowed_planned_service(oophorectomy).
allowed_planned_service(hysterectomy).
allowed_planned_service(orchiectomy_for_treatment_of_disease).
allowed_planned_service(oophorectomy_for_treatment_of_disease).
allowed_planned_service(other_treatment_demonstrated_to_result_in_infertility).

not_exceeded_max_cycles(C) :-
    claim.num_other_covered_art_services(C, N),
    N = 0.

