covered(C) <-
   % Must request an in-network ART service for fertility preservation:
   ( claim.service_type(C, ivf_for_fertility_preservation)
     ; claim.service_type(C, cryopreservation_for_fertility_preservation)
   ),
   ( claim.location_service_received(C, stanford_health_care)
     ; claim.location_service_received(C, menlo_medical_clinic)
     ; claim.location_service_received(C, sutter_health_palo_alto_medical_foundation)
     ; claim.location_service_received(C, tier_two_in_network)
   ),

   % Must not exceed the planâ€™s annual ART limit:
   claim.num_other_covered_art_services(C, UsedCycles),
   lessThan(UsedCycles, 1),

   % Must meet fertility preservation criteria:
   claim.patient_is_believed_to_be_fertile(C, yes),
   claim.planned_service(C, Planned),
   ( Planned = chemotherapy
     ; Planned = pelvic_radiotherapy
     ; Planned = gonadotoxic_therapy
     ; Planned = orchiectomy
     ; Planned = oophorectomy
     ; Planned = hysterectomy
     ; Planned = orchiectomy_for_treatment_of_disease
     ; Planned = oophorectomy_for_treatment_of_disease
     ; Planned = other_treatment_demonstrated_to_result_in_infertility
   ),

   % If eggs will be retrieved, must satisfy ovarian reserve (FSH) criteria:
   ( claim.will_be_retrieving_eggs_for_use(C, no)
     ; ( claim.will_be_retrieving_eggs_for_use(C, yes),
         not excluded_by_ovarian_reserve(C)
       )
   ).

excluded_by_ovarian_reserve(C) <-
   % Woman without POF, age >= 40, and all unmedicated Day 3 FSH >= 19
   claim.patient_has_premature_ovarian_failure(C, no),
   fact(is_woman_40_or_older(C)),
   fact(all_unmedicated_day3_fsh_prior_tests_>=19(C)).

excluded_by_ovarian_reserve(C) <-
   % Woman without POF, under 40, recent FSH >= 19
   claim.patient_has_premature_ovarian_failure(C, no),
   fact(is_woman_younger_than_40(C)),
   fact(most_recent_day3_fsh_>=19(C)).

excluded_by_ovarian_reserve(C) <-
   % Woman with POF, but 45 or older
   claim.patient_has_premature_ovarian_failure(C, yes),
   fact(is_woman_45_or_older(C)).

excluded_by_ovarian_reserve(C) <-
   % Natural menopause is not covered
   fact(natural_menopause(C, yes)).

